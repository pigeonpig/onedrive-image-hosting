var A=Object.defineProperty,_=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var L=(i,t,r)=>t in i?A(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r,f=(i,t)=>{for(var r in t||(t={}))M.call(t,r)&&L(i,r,t[r]);if(N)for(var r of N(t))j.call(t,r)&&L(i,r,t[r]);return i},I=(i,t)=>_(i,B(t));import{j as d,I as F,a as e,b as H,T as U,c as v,C as R,d as V,e as G,f as W,s as $,g as q,S as z,B as g,h as K,D as b,L as Y,G as J,P as Q,i as X,k as Z,l as ee,m as te,n as k,o as ie}from"./vendor.e164df4f.js";const ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))m(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&m(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function m(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}};ae();const x={}.VITE_CLIENT_ID,D={}.VITE_REDIRECT_URI;function re(i){return i&&i.startsWith("#")?(i=i.slice(1),Object.fromEntries(i.split("&").map(t=>t.split("=")).filter(t=>t.length===2))):{}}var ne=i=>{const{fileName:t,isUploading:r,shareUrl:m,error:a,onClickUpload:n}=i;let o,p;return a?(o=e("div",{className:"imageListItemContent",children:e("p",{className:"errorMessage",children:a})}),p=e(U,{title:"upload again",children:e(v,{sx:{color:"white"},onClick:()=>n(t),children:e(R,{})})})):r?(o=e("div",{className:"imageListItemContent"}),p=e(v,{sx:{color:"white"},children:e(R,{className:"flicker"})})):(o=e("img",{src:m,alt:t}),p=e(U,{title:"copy url",children:e(v,{sx:{color:"white"},onClick:()=>{m&&V(m)},children:e(G,{})})})),d(F,{className:"imageListItem",children:[o,e(H,{className:"imageListItemBar",title:e("div",{title:t,children:t}),position:"bottom",actionIcon:p,actionPosition:"left"})]})},le=({itemList:i,onClickUpload:t})=>e(W,{cols:5,rowHeight:164,className:"imageList",children:i.map(r=>React.createElement(ne,I(f({},r),{key:r.fileName,onClickUpload:t})))});const se=$("input")({display:"none"});var oe=({accessToken:i})=>{const[t]=React.useState(new q({accessToken:i})),[r,m]=React.useState("OneDriveImageHosting"),[a,n]=React.useState([]),o=(s,c)=>{n(u=>u.map(l=>l.fileName===s.fileName?f(f({},l),c):l))},p=s=>{o(s,{isUploading:!0,error:""}),t.upload(s.data,s.filePath).then(({id:c})=>(o(s,{isUploaded:!0,uploadId:c}),new Promise((u,l)=>{t.share(c).then(({shareId:h})=>{o(s,{isUploading:!1,shareId:h,shareUrl:ie(h)})}).catch(l)}))).catch(c=>{o(s,{isUploading:!1,error:c.message})})},O=s=>{const u=Array.from(s.target.files||[]).map(l=>({fileName:l.name,data:l,filePath:`${r}/${l.name}`,isUploading:!1,isUploaded:!1,uploadId:"",shareId:"",shareUrl:"",error:""})).filter(l=>!l.isUploading&&!l.isUploaded).filter(l=>!a.map(h=>h.fileName).includes(l.fileName));n([...a,...u.map(l=>I(f({},l),{isUploading:!0}))]),u.forEach(p)},w=s=>{const c=a.find(u=>u.fileName===s);c&&p(c)},[S,y]=React.useState(!1),T=()=>{y(!0)},P=()=>{location.href=k(x,D)},C=()=>{y(!1)};return d("div",{className:"main",children:[d(z,{direction:"row",alignItems:"center",spacing:2,className:"toolbox",children:[d("label",{children:[e(se,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:O}),e(g,{variant:"contained",component:"span",children:"Select Files"})]}),e(K,{size:"small",label:"folder name",value:r,onChange:s=>m(s.target.value)}),e(b,{orientation:"vertical",flexItem:!0}),e("span",{children:"If access_token is expired:"}),e(g,{variant:"contained",component:"span",onClick:T,children:"Open Auth Url"}),e(b,{orientation:"vertical",flexItem:!0}),e(Y,{href:"https://github.com/harrisoff/onedrive-image-hosting",target:"_blank",children:e(J,{})})]}),e(Q,{elevation:2,className:"imageListWrapper",children:a.length>0?e(le,{itemList:a,onClickUpload:w}):"Selected files will be displayed here"}),d(X,{open:S,onClose:C,children:[e(Z,{children:e(ee,{children:"You are leaving this page."})}),d(te,{children:[e(g,{color:"primary",onClick:P,children:"Go ahead"}),e(g,{color:"primary",onClick:C,children:"Cancel"})]})]})]})};const E=({label:i,message:t})=>d("p",{children:[d("span",{style:{color:"red",marginRight:"10px"},children:[i,":"]}),t]});function ce(){const{access_token:i,error:t,error_description:r}=re(location.hash);return i?e(oe,{accessToken:i}):t?d("div",{style:{margin:"20px"},children:[e(E,{label:"ERROR",message:t}),e(E,{label:"ERROR DESCRIPTION",message:r.replace(/\+/g," ")})]}):(location.href=k(x,D),e("div",{style:{margin:"20px"},children:"Redirecting to OneDrive authentication page, please wait..."}))}ReactDOM.render(e(React.StrictMode,{children:e(ce,{})}),document.getElementById("root"));
